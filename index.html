<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CoinFlip</title>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#111111">
  <style>
    :root { --size: 180px; --dur: 900ms; font-family: system-ui, sans-serif; }
    body { margin:0; min-height:100svh; display:grid; place-items:center; background:#0f1115; color:#eaecef; }
    .app { width: min(520px, 92vw); text-align:center; }
    .coin-wrap { perspective: 1000px; height: var(--size); margin: 24px auto; }
    .coin {
      position: relative; width: var(--size); height: var(--size); margin: 0 auto;
      transform-style: preserve-3d; transition: transform var(--dur) cubic-bezier(.2,.7,.2,1);
    }
    .face {
      position:absolute; inset:0; border-radius:50%;
      display:grid; place-items:center; font-weight:700; font-size:28px;
      box-shadow: inset 0 0 30px rgba(0,0,0,.35), 0 8px 24px rgba(0,0,0,.35);
      backface-visibility:hidden;
    }
    .heads { background: radial-gradient(circle at 30% 30%, #ffd27a, #d2a74a 60%, #8b6a1f); }
    .tails { background: radial-gradient(circle at 30% 30%, #9ad1ff, #3f89c9 60%, #1b4f73); transform: rotateY(180deg); }
    .btn { background:#1f6feb; border:none; padding:14px 20px; border-radius:14px; color:#fff; font-weight:700; cursor:pointer; }
    .row { display:flex; gap:12px; justify-content:center; flex-wrap:wrap; }
    .pill { padding:8px 12px; border-radius:999px; background:#161b22; border:1px solid #30363d; font-size:14px; }
    .history { margin-top:16px; font-size:14px; opacity:.9; max-height:120px; overflow:auto; text-align:left; }
  </style>
</head>
<body>
  <div class="app">
    <h1>CoinFlip</h1>
    <div class="coin-wrap">
      <div id="coin" class="coin">
        <div class="face heads">Kopf</div>
        <div class="face tails">Zahl</div>
      </div>
    </div>
    <div class="row">
      <button id="flipBtn" class="btn">Flip</button>
      <span id="result" class="pill">Bereit</span>
      <span id="stats" class="pill">K:0 · Z:0</span>
    </div>
    <div class="history" id="history"></div>
  </div>
  <script>
    // Install-Prompt (PWA)
    let deferredPrompt=null;
    window.addEventListener('beforeinstallprompt', e => { e.preventDefault(); deferredPrompt = e; });

    // Haptik (falls verfügbar)
    const vibrate = ms => (navigator.vibrate?.(ms));

    // Krypto-Random 0/1
    function randBit() {
      const a = new Uint32Array(1);
      crypto.getRandomValues(a);
      return a[0] & 1;
    }

    // State
    let heads=0, tails=0, nonce=0;
    const coin = document.getElementById('coin');
    const resultEl = document.getElementById('result');
    const statsEl = document.getElementById('stats');
    const histEl = document.getElementById('history');

    function updateStats() { statsEl.textContent = `K:${heads} · Z:${tails}`; }

    function pushHistory(text) {
      const time = new Date().toLocaleTimeString();
      const line = document.createElement('div');
      line.textContent = `[${time}] ${text}`;
      histEl.prepend(line);
      // Begrenze Historie
      while (histEl.childElementCount > 50) histEl.lastChild.remove();
    }

    async function flip() {
      // zufällige Umdrehungen für hübsche Variation
      const spins = 4 + Math.floor(Math.random()*4); // 4..7
      const bit = randBit(); // 0=heads, 1=tails
      const targetDeg = 180 * (2*spins + bit); // landet korrekt
      coin.style.transform = `rotateY(${targetDeg}deg)`;
      resultEl.textContent = '…';
      vibrate(10);
      nonce++;

      // Warte bis Animation durch ist
      await new Promise(r => setTimeout(r, 920));
      const outcome = bit === 0 ? 'Kopf' : 'Zahl';
      if (bit===0) heads++; else tails++;
      updateStats();
      resultEl.textContent = outcome;
      pushHistory(`Flip #${nonce}: ${outcome}`);
      vibrate(20);
    }

    document.getElementById('flipBtn').addEventListener('click', flip);

    // PWA Service Worker registrieren
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js').catch(console.error);
    }

    updateStats();
  </script>
</body>
</html>
